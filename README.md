# NotifySSRankChanged
ScoreSaberの順位が変動した時にiOSで通知を出すスクリプト。  
v2.0.0からScriptableからショートカットに移行しました。

## How to install
AppleのOS対応で、アンドロイドは非対応です。  
まず、もしショートカットアプリをダウンロードされていない人はApp Storeからダウンロードしてください。  
ショートカットアプリのダウンロード後は、[Releases](https://github.com/rakkyo150/NotifySSRankChanged/releases)のshortcutファイルをダウンロードしてください。  
その後、ファイルアプリのダウンロードフォルダに先ほどダウンロードしたshortcutファイルがあるはずなので、それを押してショートカットアプリに取り込みましょう。  

## Initial setting
### ショートカットの設定
shortcutファイルの取り込みが終わったら、ショートカットアプリで取り込んだショートカットに設定を入力する必要があります。  
以下の説明はiOS 26に基づいた説明ですが、基本的にはどのOSでも大きくは変わらないはずです。  
ショートカットのライブラリでNotifySSRankChangedの`•••`を押して編集画面に移行してください。  
編集画面の最初のテキストの値(デフォルトで`76561199070578780`となっている部分)をご自身のplayerIdに書き換えてください。  
playerIdはscoresaber.comのプロフィールページのURLの最後の部分にあります。  
例えば、`https://scoresaber.com/u/000000000000000`というURLの場合、`000000000000000`がplayerIdになります。  
次に、グローバルランクで動かしたい場合には、次のテキスト(デフォルトで`countryRank`となっている部分)を`rank`書き換えます。  
デフォルトの設定では順位変動がなくても通知が来るようになっています。  
この設定を変更したい場合、最後の方にある、`通知 CurrentRank: #newRankを表示`を`×`ボタンを押して削除してください。  
なお、iOSやiPad OSにおける取り消し(PCにおけるControl+zに相当)としては、シェイクが使えます。  
これらの設定をした際、ショートカットのアイコンが変わるかもしれませんが、問題はありません。  
気になるようでしたら、各自でアイコンを変更してください。

### テスト
ライブラリに戻ったらNotifySSRankChangedのショートカットをタップしてみてください。
```
SSRank/txt Not Found.
SSRank.txt will be created.
```
というアラートが出るので、OKを押しましょう。  
`"NotifySSRankChanged"が"[デフォルトのブラウザ]"に接続することを許可しますか？`と出てくるので、許可しましょう。  
次に、`"NotifySSRankChanged"が"通知を表示することを許可しますか？`と出てくるので、こちらも許可しましょう。  
そうすると、以下の通知が表示されます。
```
NotifySSRankChanged
Rank Changed Detected!
# -> #[あなたのランク]
Overwriting SSRank.txt
```
その後にファイルアプリから`Shortcuts`フォルダを見てみると、`SSRank.txt`というテキストファイルが生成されており、その中にご自身のランクが表示されているはずです。  
なお、ランク変動の通知のテストとしては、ローカルランク基準とグローバルランク基準を交互に変更して実行するのが良いです。  

### オートメーションの設定
このままだと毎回スクリプトを手動で実行する必要があるので、自動化しましょう。  
ショートカットアプリのオートメーションタブで`+`ボタンから`個人用オートメーション`の`時刻`をタップしましょう。  
`時刻`からお好きな時刻を選択して、`繰り返し`もお好きなものに設定しましょう。  
最後項目は`すぐに実行`を選択します。  
`次へ`を押したら、`マイショートカット`から`NotifySSRankchanged`を選択します。  
これで自動化できました。  
もっと頻繁に通知したい人は、オートメーションを増やすなりしましょう。  

## 既知のバグ
Mac OSのバージョンのひとつであるVenturaで取り込んだ際に、if文の条件が抜け落ちるバグを見つけました。  
私の環境のみでのバグかもしれませんが、他の環境でも同様のバグが生じるかもしれませんので、一応修正内容を記載しておきます。  
最初のif文(矢印が二股に別れているアイコンです)において、`入力`は`変数を追加`から`preRank`を選択して、`条件`を`任意の値`にします。  
次のif文において、`入力`は`変数を追加`から`newRank`を選択して、`条件`を`値がない`にします。  
最後のif文において、`入力`は`変数を追加`から`newRankText`を選択して、`条件`を`が次と等しい`にして、`テキスト`から`preRankText`を入力すると`preRankText`変数が選択できるので、これを選択してください。  
これで、修正が完了します。  

## Scriptableからの移行の理由
ScriptableのMac OS版が公式からインストール不可能になりました。  
それに伴って、開発に使用していた https://github.com/gebeto/scriptables のサポートが終了していまいました。  
また、2025.10.24時点でScriptableの更新が１年以上行われていません。  
加えて、本ツールの機能はショートカットでも十分実現可能でした。  
そこで、Scriptableからショートカットに移行しました。

## For Developers
このプロジェクトでは、[cherri](https://cherrilang.org)を使用しています。  
通常のビルドの際には`cherri NotifySSRankChanged.cherri`で十分ですが、配布のためのビルドの際には、`cherri -s=anyone NotifySSRankChanged.cherri`を実行しましょう。  